---
import PbImages from "./PbImages.astro";
const { offre } = Astro.props;
---

<article
	class={`offre-card h-full flex flex-col rounded-lg border border-gray-200 p-4 ${
		offre.favori ? "bg-slate-100" : "bg-white"
	}`}
	data-favori={offre.favori.toString()}
>
	<header class="flex items-start justify-between gap-3">
		<h2 class="text-lg font-semibold">{offre.nomMaison}</h2>

		<button class="star-button" aria-label="Favori">
			{
				offre.favori ? (
					<svg
						class="h-6 w-6 text-slate-700"
						viewBox="0 0 24 24"
						fill="currentColor"
					>
						<path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
					</svg>
				) : (
					<svg
						class="h-6 w-6 text-slate-700"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
					>
						<path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
					</svg>
				)
			}
		</button>
	</header>

	<div class="mt-4 h-64 w-full overflow-hidden rounded-md">
		<PbImages
			record={offre}
			imageField="images"
			width={400}
			height={500}
			class="w-full h-full object-cover"
		/>
	</div>

	<p class="mt-3 text-sm text-gray-600">{offre.adresse}</p>

	<p class="mt-2 text-sm">
		{offre.nbChambres} chambres • {offre.nbSdb} sdb • {offre.surface} m²
	</p>

	<p class="mt-2 mb-4 font-semibold">{offre.prix} €</p>

	<a
		href={`/offres/${offre.id}`}
		class="mt-auto rounded-lg bg-slate-700 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 text-center"
	>
		Voir plus
	</a>
</article>

<script>
	//@ts-nocheck
	const cards = document.querySelectorAll(".offre-card");

	cards.forEach((card) => {
		const starBtn = card.querySelector(".star-button");

		starBtn?.addEventListener("click", (e) => {
			e.preventDefault();

			const isFavori = card.dataset.favori === "true";
			card.dataset.favori = isFavori ? "false" : "true";

			card.classList.toggle("bg-slate-100");
			card.classList.toggle("bg-white");

			starBtn.innerHTML =
				card.dataset.favori === "true"
					? `
          <svg class="h-6 w-6 text-slate-700" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path>
          </svg>
        `
					: `
          <svg class="h-6 w-6 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path>
          </svg>
        `;
		});
	});
</script>
