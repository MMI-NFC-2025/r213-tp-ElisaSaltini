---
import Layout from "../../layouts/Layout.astro";
import Offrecard from "../../components/OffreCard.astro";
import { getOffres } from "../../backend.mjs";

const offres = await getOffres();
---

<Layout titre="Offres">
    <div class="px-4 py-6">
        <h1 class="text-4xl font-bold text-gray-900 mt-2 mb-4">OFFRES</h1>

        <div class="flex flex-row flex-wrap items-center gap-3 mb-6">
            <button
                id="favori-button"
                class="rounded-lg bg-slate-700 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
            >
                Afficher les favoris
            </button>

            <a
                href="/offres/surface/80"
                class="rounded-lg bg-slate-700 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
            >
                Voir les maisons de plus de 80 m²
            </a>

            <a
                href="/offres/prix/3000"
                class="rounded-lg bg-slate-700 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
            >
                Voir les maisons à moins de 3000 €
            </a>

            <a
                href="/offres/prix/1500/300000000"
                class="rounded-lg bg-slate-700 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
            >
                Voir les maisons entre 1500 € et 300000000 €
            </a>
        </div>

        <div class="mt-5 flex gap-6 overflow-x-auto pb-4">
            {
                offres.map((offre) => (
                    <div
                        class="offre shrink-0 w-\[420px\]"
                        data-favori={offre.favori?.toString() ?? "false"}
                    >
                        <Offrecard offre={offre} />
                    </div>
                ))
            }
        </div>
    </div>
</Layout>

<script>
    //@ts-nocheck
    const button = document.getElementById("favori-button");
    let showOnlyFavorites = false;

    button?.addEventListener("click", () => {
        showOnlyFavorites = !showOnlyFavorites;
        const offres = document.querySelectorAll(".offre");

        offres.forEach((offre) => {
            const isFavori = offre.dataset.favori === "true";

            if (showOnlyFavorites) {
                offre.style.display = isFavori ? "block" : "none";
                button.textContent = "Afficher tout";
            } else {
                offre.style.display = "block";
                button.textContent = "Afficher les favoris";
            }
        });
    });

    const cards = document.querySelectorAll(".offre-card");

    cards.forEach((card) => {
        const toggle = card.querySelector(".favori-toggle");
        if (!toggle) return;

        toggle.addEventListener("click", (e) => {
            e.stopPropagation();

            const isFavori = card.dataset.favori === "true";
            card.dataset.favori = isFavori ? "false" : "true";

            card.classList.toggle("bg-indigo-100");
            card.classList.toggle("bg-gray-100");

            toggle.textContent = isFavori ? "Standard" : "Favori";
            toggle.classList.toggle("bg-indigo-800");
            toggle.classList.toggle("text-white");
            toggle.classList.toggle("bg-slate-200");
            toggle.classList.toggle("text-indigo-950");

            const wrapper = card.closest(".offre");
            if (wrapper) wrapper.dataset.favori = card.dataset.favori;

            if (showOnlyFavorites && wrapper) {
                wrapper.style.display =
                    card.dataset.favori === "true" ? "block" : "none";
            }
        });
    });
</script>
